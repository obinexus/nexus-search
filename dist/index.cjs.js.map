{"version":3,"file":"index.cjs.js","sources":["../src/types/errors.ts","../src/types/index.ts","../src/mappers/DataMapper.ts","../src/algorithms/trie/TrieNode.ts","../src/algorithms/trie/TrieSearch.ts","../src/mappers/IndexMapper.ts","../src/utils/SearchUtils.ts","../src/core/IndexManager.ts","../src/core/QueryProcessor.ts","../src/storage/IndexedDB.ts","../src/storage/CacheManager.ts","../src/utils/ValidationUtils.ts","../src/core/SearchEngine.ts"],"sourcesContent":["export class SearchError extends Error {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'SearchError';\r\n  }\r\n}\r\n\r\nexport class IndexError extends Error {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'IndexError';\r\n  }\r\n}\r\n\r\nexport class ValidationError extends Error {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'ValidationError';\r\n  }\r\n}\r\n\r\nexport class StorageError extends Error {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'StorageError';\r\n  }\r\n}","\r\n\r\nexport * from './types';\r\nexport * from './errors';\r\nexport * from './events';\r\nexport * from './internal';\r\nexport * from './guards';\r\nexport * from './utils';\r\nexport * from './defaults';\r\n\r\n// Event types implementation\r\nexport type SearchEventType = \r\n  | 'search:start'\r\n  | 'search:complete'\r\n  | 'search:error'\r\n  | 'index:start'\r\n  | 'index:complete'\r\n  | 'index:error'\r\n  | 'storage:error';\r\n\r\nexport interface SearchEvent {\r\n  type: SearchEventType;\r\n  timestamp: number;\r\n  data?: any;\r\n  error?: Error;\r\n}\r\n\r\nexport interface SearchEventListener {\r\n  (event: SearchEvent): void;\r\n}\r\n\r\n// Internal types implementation\r\nexport interface IndexNode {\r\n  id: string;\r\n  value: any;\r\n  score: number;\r\n  children: Map<string, IndexNode>;\r\n}\r\n\r\nexport interface SearchContext {\r\n  query: string;\r\n  options: SearchOptions;\r\n  startTime: number;\r\n  results: SearchResult<any>[];\r\n  stats: SearchStats;\r\n}\r\n\r\nexport interface TokenInfo {\r\n  value: string;\r\n  type: 'word' | 'operator' | 'modifier' | 'delimiter';\r\n  position: number;\r\n  length: number;\r\n}\r\n\r\n// Type guards\r\nexport function isSearchOptions(obj: any): obj is SearchOptions {\r\n  return obj && (\r\n    typeof obj.fuzzy === 'undefined' || typeof obj.fuzzy === 'boolean'\r\n  ) && (\r\n    typeof obj.maxResults === 'undefined' || typeof obj.maxResults === 'number'\r\n  );\r\n}\r\n\r\nexport function isIndexConfig(obj: any): obj is IndexConfig {\r\n  return obj && \r\n    typeof obj.name === 'string' &&\r\n    typeof obj.version === 'number' &&\r\n    Array.isArray(obj.fields);\r\n}\r\n\r\nexport function isSearchResult<T>(obj: any): obj is SearchResult<T> {\r\n  return obj &&\r\n    'item' in obj &&\r\n    typeof obj.score === 'number' &&\r\n    Array.isArray(obj.matches);\r\n}\r\n\r\n// Utility type functions\r\nexport function createSearchStats(): SearchStats {\r\n  return {\r\n    totalResults: 0,\r\n    searchTime: 0,\r\n    indexSize: 0,\r\n    queryComplexity: 0\r\n  };\r\n}\r\n\r\nexport function createSearchContext(\r\n  query: string,\r\n  options: SearchOptions = {}\r\n): SearchContext {\r\n  return {\r\n    query,\r\n    options,\r\n    startTime: Date.now(),\r\n    results: [],\r\n    stats: createSearchStats()\r\n  };\r\n}\r\n\r\nexport function createTokenInfo(\r\n  value: string,\r\n  type: TokenInfo['type'],\r\n  position: number\r\n): TokenInfo {\r\n  return {\r\n    value,\r\n    type,\r\n    position,\r\n    length: value.length\r\n  };\r\n}\r\n\r\n// Default configurations\r\nexport const DEFAULT_INDEX_OPTIONS: Required<IndexOptions> = {\r\n  caseSensitive: false,\r\n  stemming: true,\r\n  stopWords: ['the', 'a', 'an', 'and', 'or', 'but'],\r\n  minWordLength: 2,\r\n  maxWordLength: 50,\r\n  fuzzyThreshold: 0.8\r\n};\r\n\r\nexport const DEFAULT_SEARCH_OPTIONS: Required<SearchOptions> = {\r\n  fuzzy: false,\r\n  maxResults: 10,\r\n  threshold: 0.5,\r\n  fields: [],\r\n  sortBy: 'score',\r\n  sortOrder: 'desc',\r\n  page: 1,\r\n  pageSize: 10\r\n};\r\n\r\n// Export a namespace for internal use\r\nexport namespace NexusSearch {\r\n  export interface InternalConfig extends IndexConfig {\r\n    _id: string;\r\n    _created: number;\r\n    _updated: number;\r\n  }\r\n\r\n  export interface QueryContext extends SearchContext {\r\n    _processed: boolean;\r\n    _cached: boolean;\r\n  }\r\n}\r\nexport interface SearchOptions {\r\n    fuzzy?: boolean;\r\n    maxResults?: number;\r\n    threshold?: number;\r\n    fields?: string[];\r\n    sortBy?: string;\r\n    sortOrder?: 'asc' | 'desc';\r\n    page?: number;\r\n    pageSize?: number;\r\n  }\r\n  \r\n  export interface SearchResult<T> {\r\n    item: T;\r\n    score: number;\r\n    matches: string[];\r\n    highlights?: Record<string, string[]>;\r\n  }\r\n  \r\n  export interface IndexConfig {\r\n    name: string;\r\n    version: number;\r\n    fields: string[];\r\n    options?: IndexOptions;\r\n  }\r\n  \r\n  export interface IndexOptions {\r\n    caseSensitive?: boolean;\r\n    stemming?: boolean;\r\n    stopWords?: string[];\r\n    minWordLength?: number;\r\n    maxWordLength?: number;\r\n    fuzzyThreshold?: number;\r\n  }\r\n  \r\n  export interface SearchStats {\r\n    totalResults: number;\r\n    searchTime: number;\r\n    indexSize: number;\r\n    queryComplexity: number;\r\n  }\r\n\r\n  ","\r\n  export class DataMapper {\r\n    private dataMap: Map<string, Set<string>>;\r\n  \r\n    constructor() {\r\n      this.dataMap = new Map();\r\n    }\r\n  \r\n    mapData(key: string, documentId: string): void {\r\n      if (!this.dataMap.has(key)) {\r\n        this.dataMap.set(key, new Set());\r\n      }\r\n      this.dataMap.get(key)!.add(documentId);\r\n    }\r\n  \r\n    getDocuments(key: string): Set<string> {\r\n      return this.dataMap.get(key) || new Set();\r\n    }\r\n  \r\n    getAllKeys(): string[] {\r\n      return Array.from(this.dataMap.keys());\r\n    }\r\n  \r\n    clear(): void {\r\n      this.dataMap.clear();\r\n    }\r\n  }\r\n  \r\n","export class TrieNode {\r\n    children: Map<string, TrieNode>;\r\n    isEndOfWord: boolean;\r\n    data: Set<string>;\r\n    \r\n    constructor() {\r\n      this.children = new Map();\r\n      this.isEndOfWord = false;\r\n      this.data = new Set();\r\n    }\r\n  }\r\n  ","import { TrieNode } from \"./TrieNode\";\r\n\r\nexport class TrieSearch {\r\n  private root: TrieNode;\r\n\r\n  constructor() {\r\n    this.root = new TrieNode();\r\n  }\r\n\r\n  insert(word: string, documentId: string): void {\r\n    let current = this.root;\r\n    \r\n    for (const char of word.toLowerCase()) {\r\n      if (!current.children.has(char)) {\r\n        current.children.set(char, new TrieNode());\r\n      }\r\n      current = current.children.get(char)!;\r\n    }\r\n    \r\n    current.isEndOfWord = true;\r\n    current.data.add(documentId);\r\n  }\r\n\r\n  search(prefix: string, maxResults: number = 10): Set<string> {\r\n    const results = new Set<string>();\r\n    let current = this.root;\r\n\r\n    for (const char of prefix.toLowerCase()) {\r\n      if (!current.children.has(char)) {\r\n        return results;\r\n      }\r\n      current = current.children.get(char)!;\r\n    }\r\n\r\n    this.collectIds(current, results, maxResults);\r\n    return results;\r\n  }\r\n\r\n  private collectIds(node: TrieNode, results: Set<string>, maxResults: number): void {\r\n    if (node.isEndOfWord) {\r\n      for (const id of node.data) {\r\n        if (results.size >= maxResults) return;\r\n        results.add(id);\r\n      }\r\n    }\r\n\r\n    for (const child of node.children.values()) {\r\n      if (results.size >= maxResults) return;\r\n      this.collectIds(child, results, maxResults);\r\n    }\r\n  }\r\n\r\n  fuzzySearch(word: string, maxDistance: number = 2): Set<string> {\r\n    const results = new Set<string>();\r\n    this.fuzzySearchHelper(word.toLowerCase(), this.root, '', maxDistance, results);\r\n    return results;\r\n  }\r\n\r\n  private fuzzySearchHelper(\r\n    word: string,\r\n    node: TrieNode,\r\n    currentWord: string,\r\n    maxDistance: number,\r\n    results: Set<string>\r\n  ): void {\r\n    if (maxDistance < 0) return;\r\n\r\n    if (node.isEndOfWord) {\r\n      const distance = this.levenshteinDistance(word, currentWord);\r\n      if (distance <= maxDistance) {\r\n        node.data.forEach(id => results.add(id));\r\n      }\r\n    }\r\n\r\n    for (const [char, childNode] of node.children) {\r\n      this.fuzzySearchHelper(\r\n        word,\r\n        childNode,\r\n        currentWord + char,\r\n        maxDistance,\r\n        results\r\n      );\r\n    }\r\n  }\r\n\r\n  private levenshteinDistance(s1: string, s2: string): number {\r\n    const dp: number[][] = Array(s1.length + 1)\r\n      .fill(0)\r\n      .map(() => Array(s2.length + 1).fill(0));\r\n\r\n    for (let i = 0; i <= s1.length; i++) dp[i][0] = i;\r\n    for (let j = 0; j <= s2.length; j++) dp[0][j] = j;\r\n\r\n    for (let i = 1; i <= s1.length; i++) {\r\n      for (let j = 1; j <= s2.length; j++) {\r\n        dp[i][j] = Math.min(\r\n          dp[i - 1][j] + 1,\r\n          dp[i][j - 1] + 1,\r\n          dp[i - 1][j - 1] + (s1[i - 1] !== s2[j - 1] ? 1 : 0)\r\n        );\r\n      }\r\n    }\r\n\r\n    return dp[s1.length][s2.length];\r\n  }\r\n}","import { SearchResult } from '../types';\r\nimport { DataMapper } from './DataMapper';\r\nimport { TrieSearch } from '../algorithms/trie/TrieSearch';\r\n\r\nexport class IndexMapper {\r\n  private dataMapper: DataMapper;\r\n  private trieSearch: TrieSearch;\r\n\r\n  constructor() {\r\n    this.dataMapper = new DataMapper();\r\n    this.trieSearch = new TrieSearch();\r\n  }\r\n\r\n  indexDocument(document: any, id: string, fields: string[]): void {\r\n    fields.forEach(field => {\r\n      const value = document[field];\r\n      if (typeof value === 'string') {\r\n        const words = value.split(/\\s+/);\r\n        words.forEach(word => {\r\n          this.trieSearch.insert(word, id);\r\n          this.dataMapper.mapData(word.toLowerCase(), id);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  search(query: string, options: { fuzzy?: boolean; maxResults?: number } = {}): SearchResult<string>[] {\r\n    const { fuzzy = false, maxResults = 10 } = options;\r\n    \r\n    const documentIds = fuzzy\r\n      ? this.trieSearch.fuzzySearch(query)\r\n      : this.trieSearch.search(query, maxResults);\r\n\r\n    const results: SearchResult<string>[] = Array.from(documentIds).map(id => ({\r\n      item: id as string,\r\n      score: this.calculateScore(id, query),\r\n      matches: [query]\r\n    }));\r\n\r\n    return results.slice(0, maxResults);\r\n  }\r\n\r\n  private calculateScore(documentId: string, query: string): number {\r\n    // Basic scoring implementation - can be enhanced\r\n    const exactMatch = this.dataMapper.getDocuments(query.toLowerCase()).has(documentId);\r\n    return exactMatch ? 1.0 : 0.5;\r\n  }\r\n}\r\n","import { SearchOptions } from '../types';\r\n\r\n\r\nexport function createSearchableFields<T>(\r\n  document: T,\r\n  fields: string[]\r\n): Record<string, string> {\r\n  const searchableFields: Record<string, string> = {};\r\n\r\n  fields.forEach(field => {\r\n    const value = getNestedValue(document, field);\r\n    if (value !== undefined) {\r\n      searchableFields[field] = normalizeFieldValue(value);\r\n    }\r\n  });\r\n\r\n  return searchableFields;\r\n}\r\n\r\nexport function normalizeFieldValue(value: any): string {\r\n  if (typeof value === 'string') {\r\n    return value.toLowerCase().trim();\r\n  }\r\n  if (Array.isArray(value)) {\r\n    return value.map(v => normalizeFieldValue(v)).join(' ');\r\n  }\r\n  if (typeof value === 'object' && value !== null) {\r\n    return Object.values(value).map(v => normalizeFieldValue(v)).join(' ');\r\n  }\r\n  return String(value);\r\n}\r\n\r\nexport function getNestedValue(obj: any, path: string): any {\r\n  return path.split('.').reduce((current, key) => \r\n    current && current[key] !== undefined ? current[key] : undefined, \r\n    obj\r\n  );\r\n}\r\n\r\nexport function optimizeIndex(data: any[]): any[] {\r\n  // Remove duplicates\r\n  const uniqueData = Array.from(new Set(data.map(item => \r\n    JSON.stringify(item)\r\n  ))).map(item => JSON.parse(item));\r\n\r\n  // Sort for binary search optimization\r\n  return uniqueData.sort((a, b) => \r\n    JSON.stringify(a).localeCompare(JSON.stringify(b))\r\n  );\r\n}\r\n\r\n","import { IndexMapper } from \"@/mappers/IndexMapper\";\r\nimport { IndexConfig, SearchOptions, SearchResult } from \"@/types\";\r\nimport { createSearchableFields } from \"@/utils/SearchUtils\";\r\n\r\nexport class IndexManager {\r\n    private indexMapper: IndexMapper;\r\n    private config: IndexConfig;\r\n    private documents: Map<string, any>;\r\n  \r\n    constructor(config: IndexConfig) {\r\n      this.config = config;\r\n      this.indexMapper = new IndexMapper();\r\n      this.documents = new Map();\r\n    }\r\n  \r\n    async addDocuments<T>(documents: T[]): Promise<void> {\r\n      documents.forEach((doc, index) => {\r\n        const id = this.generateDocumentId(index);\r\n        this.documents.set(id, doc);\r\n        \r\n        const searchableFields = createSearchableFields(doc, this.config.fields);\r\n        this.indexMapper.indexDocument(searchableFields, id, this.config.fields);\r\n      });\r\n    }\r\n  \r\n    async search<T>(query: string, options: SearchOptions): Promise<SearchResult<T>[]> {\r\n      const searchResults = this.indexMapper.search(query, {\r\n        fuzzy: options.fuzzy,\r\n        maxResults: options.maxResults\r\n      });\r\n  \r\n      return searchResults.map(result => ({\r\n        item: this.documents.get(result.item) as T,\r\n        score: result.score,\r\n        matches: result.matches\r\n      }));\r\n    }\r\n  \r\n    exportIndex(): any {\r\n      return {\r\n        documents: Array.from(this.documents.entries()),\r\n        config: this.config\r\n      };\r\n    }\r\n  \r\n    importIndex(data: any): void {\r\n      this.documents = new Map(data.documents);\r\n      this.config = data.config;\r\n    }\r\n  \r\n    clear(): void {\r\n      this.documents.clear();\r\n      this.indexMapper = new IndexMapper();\r\n    }\r\n  \r\n    private generateDocumentId(index: number): string {\r\n      return `${this.config.name}-${index}-${Date.now()}`;\r\n    }\r\n  }\r\n  ","type QueryToken = {\r\n  type: 'term' | 'operator' | 'modifier';\r\n  value: string;\r\n};\r\n\r\nexport class QueryProcessor {\r\n  private readonly STOP_WORDS = new Set([\r\n    'a', 'an', 'and', 'are', 'as', 'at', 'be', 'by', 'for',\r\n    'from', 'has', 'he', 'in', 'is', 'it', 'its', 'of', 'on',\r\n    'that', 'the', 'to', 'was', 'were', 'will', 'with'\r\n  ]);\r\n\r\n  process(query: string): string {\r\n    const tokens = this.tokenize(query);\r\n    const processedTokens = this.processTokens(tokens);\r\n    return this.optimizeQuery(processedTokens);\r\n  }\r\n\r\n  private tokenize(query: string): QueryToken[] {\r\n    return query\r\n      .toLowerCase()\r\n      .split(/\\s+/)\r\n      .filter(term => term.length > 0)\r\n      .map(term => this.classifyToken(term));\r\n  }\r\n\r\n  private classifyToken(term: string): QueryToken {\r\n    if (term.startsWith('+') || term.startsWith('-')) {\r\n      return { type: 'operator', value: term };\r\n    }\r\n    if (term.includes(':')) {\r\n      return { type: 'modifier', value: term };\r\n    }\r\n    return { type: 'term', value: term };\r\n  }\r\n\r\n  private processTokens(tokens: QueryToken[]): QueryToken[] {\r\n    return tokens\r\n      .filter(token => \r\n        token.type !== 'term' || !this.STOP_WORDS.has(token.value)\r\n      )\r\n      .map(token => this.normalizeToken(token));\r\n  }\r\n\r\n  private normalizeToken(token: QueryToken): QueryToken {\r\n    if (token.type === 'term') {\r\n      // Basic stemming (could be enhanced with proper stemming algorithm)\r\n      let value = token.value;\r\n      if (value.endsWith('ing')) value = value.slice(0, -3);\r\n      if (value.endsWith('s')) value = value.slice(0, -1);\r\n      return { ...token, value };\r\n    }\r\n    return token;\r\n  }\r\n\r\n  private optimizeQuery(tokens: QueryToken[]): string {\r\n    return tokens\r\n      .map(token => token.value)\r\n      .join(' ');\r\n  }\r\n}","import { openDB, DBSchema, IDBPDatabase } from 'idb';\r\nimport { IndexConfig } from '../types';\r\n\r\ninterface SearchDBSchema extends DBSchema {\r\n  searchIndices: {\r\n    key: string;\r\n    value: {\r\n      id: string;\r\n      data: any;\r\n      timestamp: number;\r\n    };\r\n  };\r\n  metadata: {\r\n    key: string;\r\n    value: MetadataEntry;\r\n  };\r\n}\r\n\r\ninterface MetadataEntry {\r\n  config: IndexConfig;\r\n  lastUpdated: number;\r\n}\r\n\r\nexport class SearchStorage {\r\n  private db: IDBPDatabase<SearchDBSchema> | null = null;\r\n  private readonly DB_NAME = 'nexus_search_db';\r\n  private readonly DB_VERSION = 1;\r\n\r\n  async initialize(): Promise<void> {\r\n    try {\r\n      this.db = await openDB<SearchDBSchema>(this.DB_NAME, this.DB_VERSION, {\r\n        upgrade(db) {\r\n          // Create stores if they don't exist\r\n          if (!db.objectStoreNames.contains('searchIndices')) {\r\n            db.createObjectStore('searchIndices', { keyPath: 'id' });\r\n          }\r\n          if (!db.objectStoreNames.contains('metadata')) {\r\n            db.createObjectStore('metadata', { keyPath: 'id' });\r\n          }\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to initialize IndexedDB:', error);\r\n      throw new Error('Storage initialization failed');\r\n    }\r\n  }\r\n\r\n  async storeIndex(key: string, data: any): Promise<void> {\r\n    if (!this.db) throw new Error('Database not initialized');\r\n    \r\n    const entry = {\r\n      id: key,\r\n      data,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    await this.db.put('searchIndices', entry);\r\n  }\r\n\r\n  async getIndex(key: string): Promise<any | null> {\r\n    if (!this.db) throw new Error('Database not initialized');\r\n    \r\n    const entry = await this.db.get('searchIndices', key);\r\n    return entry?.data || null;\r\n  }\r\n\r\n  async updateMetadata(config: IndexConfig): Promise<void> {\r\n    if (!this.db) throw new Error('Database not initialized');\r\n    \r\n    const metadata: MetadataEntry = {\r\n      config,\r\n      lastUpdated: Date.now()\r\n    };\r\n    \r\n    await this.db.put('metadata', metadata, 'config');\r\n  }\r\n\r\n  async clearIndices(): Promise<void> {\r\n    if (!this.db) throw new Error('Database not initialized');\r\n    \r\n    await this.db.clear('searchIndices');\r\n  }\r\n\r\n\r\n}\r\n","import { SearchResult } from '../types';\r\n\r\nexport class CacheManager {\r\n  private cache: Map<string, { data: SearchResult<any>[]; timestamp: number }>;\r\n  private readonly maxSize: number;\r\n  private readonly ttl: number; // Time to live in milliseconds\r\n\r\n  constructor(maxSize: number = 1000, ttlMinutes: number = 5) {\r\n    this.cache = new Map();\r\n    this.maxSize = maxSize;\r\n    this.ttl = ttlMinutes * 60 * 1000;\r\n  }\r\n\r\n  set(key: string, data: SearchResult<any>[]): void {\r\n    if (this.cache.size >= this.maxSize) {\r\n      this.evictOldest();\r\n    }\r\n\r\n    this.cache.set(key, {\r\n      data,\r\n      timestamp: Date.now(),\r\n    });\r\n  }\r\n\r\n  get(key: string): SearchResult<any>[] | null {\r\n    const entry = this.cache.get(key);\r\n    \r\n    if (!entry) return null;\r\n    \r\n    if (this.isExpired(entry.timestamp)) {\r\n      this.cache.delete(key);\r\n      return null;\r\n    }\r\n\r\n    return entry.data;\r\n  }\r\n\r\n  private isExpired(timestamp: number): boolean {\r\n    return Date.now() - timestamp > this.ttl;\r\n  }\r\n\r\n  private evictOldest(): void {\r\n    let oldestKey: string | null = null;\r\n    let oldestTime = Infinity;\r\n\r\n    for (const [key, entry] of this.cache.entries()) {\r\n      if (entry.timestamp < oldestTime) {\r\n        oldestTime = entry.timestamp;\r\n        oldestKey = key;\r\n      }\r\n    }\r\n\r\n    if (oldestKey) {\r\n      this.cache.delete(oldestKey);\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.cache.clear();\r\n  }\r\n}","import { SearchOptions, IndexConfig } from '@types';\r\nimport { getNestedValue } from './SearchUtils';\r\n\r\nexport function validateSearchOptions(options: SearchOptions): void {\r\n  if (options.maxResults && options.maxResults < 1) {\r\n    throw new Error('maxResults must be greater than 0');\r\n  }\r\n\r\n  if (options.threshold && (options.threshold < 0 || options.threshold > 1)) {\r\n    throw new Error('threshold must be between 0 and 1');\r\n  }\r\n\r\n  if (options.fields && !Array.isArray(options.fields)) {\r\n    throw new Error('fields must be an array');\r\n  }\r\n}\r\n\r\nexport function validateIndexConfig(config: IndexConfig): void {\r\n  if (!config.name) {\r\n    throw new Error('Index name is required');\r\n  }\r\n\r\n  if (!config.version || typeof config.version !== 'number') {\r\n    throw new Error('Valid version number is required');\r\n  }\r\n\r\n  if (!Array.isArray(config.fields) || config.fields.length === 0) {\r\n    throw new Error('At least one field must be specified for indexing');\r\n  }\r\n}\r\n\r\nexport function validateDocument(document: any, fields: string[]): boolean {\r\n  return fields.every(field => {\r\n    const value = getNestedValue(document, field);\r\n    return value !== undefined;\r\n  });\r\n}","import { SearchOptions, SearchResult, IndexConfig } from '../types';\r\nimport { IndexManager } from './IndexManager';\r\nimport { QueryProcessor } from './QueryProcessor';\r\nimport { SearchStorage } from '../storage/IndexedDB';\r\nimport { CacheManager } from '../storage/CacheManager';\r\nimport { validateSearchOptions } from '@/utils/ValidationUtils';\r\n\r\nexport class SearchEngine {\r\n  private indexManager: IndexManager;\r\n  private queryProcessor: QueryProcessor;\r\n  private storage: SearchStorage;\r\n  private cache: CacheManager;\r\n  private config: IndexConfig;\r\n\r\n  constructor(config: IndexConfig) {\r\n    this.config = config;\r\n    this.indexManager = new IndexManager(config);\r\n    this.queryProcessor = new QueryProcessor();\r\n    this.storage = new SearchStorage();\r\n    this.cache = new CacheManager();\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    try {\r\n      await this.storage.initialize();\r\n      await this.loadIndexes();\r\n    } catch (error) {\r\n      throw new Error(`Failed to initialize search engine: ${error}`);\r\n    }\r\n  }\r\n\r\n  async addDocuments<T>(documents: T[]): Promise<void> {\r\n    try {\r\n      await this.indexManager.addDocuments(documents);\r\n      await this.storage.storeIndex(this.config.name, this.indexManager.exportIndex());\r\n    } catch (error) {\r\n      throw new Error(`Failed to add documents: ${error}`);\r\n    }\r\n  }\r\n\r\n  async search<T>(query: string, options: SearchOptions = {}): Promise<SearchResult<T>[]> {\r\n    validateSearchOptions(options);\r\n    \r\n    const cacheKey = this.generateCacheKey(query, options);\r\n    const cachedResults = this.cache.get(cacheKey);\r\n    \r\n    if (cachedResults) {\r\n      return cachedResults as SearchResult<T>[];\r\n    }\r\n\r\n    const processedQuery = this.queryProcessor.process(query);\r\n    const results = await this.indexManager.search<T>(processedQuery, options);\r\n    \r\n    this.cache.set(cacheKey, results);\r\n    return results;\r\n  }\r\n\r\n  private async loadIndexes(): Promise<void> {\r\n    const storedIndex = await this.storage.getIndex(this.config.name);\r\n    if (storedIndex) {\r\n      this.indexManager.importIndex(storedIndex);\r\n    }\r\n  }\r\n\r\n  private generateCacheKey(query: string, options: SearchOptions): string {\r\n    return `${query}-${JSON.stringify(options)}`;\r\n  }\r\n\r\n  async clearIndex(): Promise<void> {\r\n    await this.storage.clearIndices();\r\n    this.indexManager.clear();\r\n    this.cache.clear();\r\n  }\r\n}\r\n"],"names":["openDB"],"mappings":"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"}